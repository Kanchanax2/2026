<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fireworks • Kanchana Ishodhara</title>
  <style>
    :root{color-scheme:dark;}
    html,body{height:100%;margin:0;overflow:hidden;background:#03040a;}
    canvas{display:block;width:100vw;height:100vh;}
    .credit{
      position:fixed;left:0;right:0;bottom:10px;
      text-align:center;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      font-size:12px;letter-spacing:.3px;
      color:rgba(255,255,255,.85);
      opacity:.78;
      text-shadow:0 2px 12px rgba(0,0,0,.65);
      pointer-events:none;user-select:none;
    }
  </style>
</head>
<body>
  <canvas id="c"></canvas>
  <div class="credit">Created by Kanchana Ishodhara</div>

<script>
(function () {
  "use strict";

  var canvas = document.getElementById("c");
  var ctx = canvas.getContext("2d"); // (compatibility-safe)
  var dpr = 1, W = 0, H = 0;

  function DPR() {
    var v = window.devicePixelRatio || 1;
    if (v < 1) v = 1;
    if (v > 2) v = 2;
    return v;
  }

  function resize() {
    dpr = DPR();
    W = Math.floor(window.innerWidth * dpr);
    H = Math.floor(window.innerHeight * dpr);
    canvas.width = W;
    canvas.height = H;
  }
  window.addEventListener("resize", resize, { passive: true });
  resize();

  function rand(a, b) { return a + Math.random() * (b - a); }
  function clamp(x, a, b) { return Math.max(a, Math.min(b, x)); }

  // Themes (no UI) — auto change
  var themes = [
    { bg:[3,4,10], fade:0.22, hueMin:180, hueMax:320, gravity:0.060 },
    { bg:[4,2,12], fade:0.24, hueMin:240, hueMax:360, gravity:0.058 },
    { bg:[10,3,6], fade:0.20, hueMin:  5, hueMax: 70, gravity:0.062 },
    { bg:[2,8,7],  fade:0.23, hueMin: 80, hueMax:170, gravity:0.060 }
  ];
  var themeIndex = 0;
  var theme = themes[themeIndex];
  var themeTimer = 0;
  var THEME_SWITCH_SEC = 10;

  // Engine state
  var rockets = [];
  var particles = [];
  var maxParticles = 2200;

  function Rocket(sx, sy, tx, ty, hue, pattern) {
    this.x = sx; this.y = sy;
    this.tx = tx; this.ty = ty;
    this.hue = hue;
    this.pattern = pattern;
    this.life = 0;

    var dx = tx - sx;
    var dy = ty - sy;
    var dist = Math.sqrt(dx*dx + dy*dy) || 1;

    var speed = rand(9, 13) * dpr;
    this.vx = (dx / dist) * speed;
    this.vy = (dy / dist) * speed;

    this.trail = [];
    for (var i = 0; i < 7; i++) this.trail.push({ x: this.x, y: this.y });
  }

  Rocket.prototype.update = function(dt) {
    this.life += dt;

    this.trail.pop();
    this.trail.unshift({ x: this.x, y: this.y });

    this.x += this.vx * dt * 60;
    this.y += this.vy * dt * 60;

    // slight acceleration (nice pop)
    this.vx *= 1.01;
    this.vy *= 1.01;

    var dx = this.tx - this.x;
    var dy = this.ty - this.y;

    if ((dx*dx + dy*dy) < (22*dpr)*(22*dpr) || this.life > 1.9) {
      explode(this.x, this.y, this.hue, this.pattern);
      return false;
    }
    return true;
  };

  Rocket.prototype.draw = function() {
    ctx.beginPath();
    var t = this.trail;
    ctx.moveTo(t[t.length-1].x, t[t.length-1].y);
    for (var i = t.length-2; i >= 0; i--) ctx.lineTo(t[i].x, t[i].y);
    ctx.strokeStyle = "hsla(" + this.hue + ",100%,70%,0.85)";
    ctx.lineWidth = 2.2 * dpr;
    ctx.stroke();

    ctx.beginPath();
    ctx.arc(this.x, this.y, 2.0 * dpr, 0, Math.PI * 2);
    ctx.fillStyle = "hsla(" + this.hue + ",100%,80%,1)";
    ctx.fill();
  };

  function Particle(x, y, vx, vy, hue, life, size, sparkle) {
    this.x = x; this.y = y;
    this.vx = vx; this.vy = vy;
    this.hue = hue + rand(-16, 16);
    this.life = life;
    this.age = 0;
    this.size = size;
    this.a = 1;
    this.sparkle = !!sparkle;
    this.seed = Math.random() * 10;
  }

  Particle.prototype.update = function(dt) {
    this.age += dt;

    // friction
    this.vx *= Math.pow(0.985, dt * 60);
    this.vy *= Math.pow(0.985, dt * 60);

    // gravity
    this.vy += theme.gravity * dt * 60 * dpr;

    this.x += this.vx * dt * 60;
    this.y += this.vy * dt * 60;

    var t = clamp(1 - (this.age / this.life), 0, 1);
    this.a = t * t;

    return this.age < this.life && this.y < H + 80 * dpr;
  };

  Particle.prototype.draw = function() {
    var pulse = 1;
    if (this.sparkle) {
      pulse = 0.55 + 0.45 * Math.sin((Date.now() * 0.02) + this.seed);
    }
    ctx.beginPath();
    ctx.arc(this.x, this.y, this.size * pulse, 0, Math.PI * 2);
    ctx.fillStyle = "hsla(" + this.hue + ",100%,65%," + this.a + ")";
    ctx.fill();
  };

  var patterns = ["burst", "ring", "heart", "willow", "crackle"];

  function pushParticle(p) {
    particles.push(p);
    if (particles.length > maxParticles) particles.splice(0, particles.length - maxParticles);
  }

  function explode(x, y, hue, pattern) {
    var base = 110;

    if (pattern === "ring") {
      var countR = Math.floor(base * 1.0);
      var spR = rand(3.2, 6.0) * dpr;
      for (var i = 0; i < countR; i++) {
        var a = (i / countR) * Math.PI * 2;
        pushParticle(new Particle(x, y, Math.cos(a)*spR, Math.sin(a)*spR, hue, rand(1.0,1.6), rand(1.0,2.2)*dpr, true));
      }
      return;
    }

    if (pattern === "heart") {
      var countH = Math.floor(base * 1.25);
      var s = rand(0.22, 0.32) * dpr * 1.25;
      for (var j = 0; j < countH; j++) {
        var t = (j / countH) * Math.PI * 2;
        var hx = 16 * Math.pow(Math.sin(t), 3);
        var hy = 13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t);
        pushParticle(new Particle(x, y, hx*s, -hy*s, hue, rand(1.1,1.8), rand(1.0,2.0)*dpr, true));
      }
      return;
    }

    if (pattern === "willow") {
      var countW = Math.floor(base * 1.15);
      for (var k = 0; k < countW; k++) {
        var aw = rand(0, Math.PI * 2);
        var spw = rand(1.0, 4.2) * dpr;
        pushParticle(new Particle(x, y, Math.cos(aw)*spw, Math.sin(aw)*spw, hue, rand(1.5,2.5), rand(1.0,2.1)*dpr, false));
      }
      return;
    }

    if (pattern === "crackle") {
      var countC = Math.floor(base * 0.9);
      for (var m = 0; m < countC; m++) {
        var ac = rand(0, Math.PI * 2);
        var spc = rand(1.6, 6.6) * dpr;
        pushParticle(new Particle(x, y, Math.cos(ac)*spc, Math.sin(ac)*spc, hue, rand(0.8,1.4), rand(0.9,1.9)*dpr, true));
      }
      // micro sparks
      for (var n = 0; n < 120; n++) {
        var am = rand(0, Math.PI * 2);
        var spm = rand(0.6, 3.0) * dpr;
        pushParticle(new Particle(x, y, Math.cos(am)*spm, Math.sin(am)*spm, hue + rand(-30,30), rand(0.45,0.85), rand(0.6,1.2)*dpr, true));
      }
      return;
    }

    // default burst
    var countB = base;
    for (var q = 0; q < countB; q++) {
      var ab = rand(0, Math.PI * 2);
      var spb = rand(1.2, 6.2) * dpr;
      pushParticle(new Particle(x, y, Math.cos(ab)*spb, Math.sin(ab)*spb, hue, rand(0.9,1.6), rand(1.0,2.2)*dpr, true));
    }
  }

  function launch(tx, ty) {
    var sx = W * 0.5 + rand(-120, 120) * dpr;
    var sy = H + 20 * dpr*
